!function(t,i){"function"==typeof define&&define.amd?define(["jquery"],i):i(t.jQuery)}(this,function(t){"use strict";function i(t,i){return typeof t===i}function e(t,i){return!!~(""+t).indexOf(i)}function s(t,i){for(var s in t){var o=t[s];if(!e(o,"-")&&void 0!==m[o])return"pfx"==i?o:!0}return!1}function o(t,e,s){for(var o in t){var r=e[t[o]];if(void 0!==r)return s===!1?t[o]:i(r,"function")?r.bind(s||e):r}return!1}function r(t,e,r){var n=t.charAt(0).toUpperCase()+t.slice(1),l=(t+" "+u.join(n+" ")+n).split(" ");return i(e,"string")||i(e,"undefined")?s(l,e):(l=(t+" "+p.join(n+" ")+n).split(" "),o(l,e,r))}var n,l,a={image:null,imageAttribute:"image",holderClass:"imageHolder",container:t("body"),speed:.2,coverRatio:1.25,holderMinHeight:200,extraHeight:0,mediaWidth:1600,mediaHeight:1e3,parallax:!0,touch:!1},h={},d=document.documentElement,c="imageScrollModernizr",g=document.createElement(c),m=g.style,f="Webkit Moz O ms",u=f.split(" "),p=f.toLowerCase().split(" "),H={},v=t(window),x=0,b="",y=function(t,i,e,s){var o,r,n,l,a=document.createElement("div"),h=document.body,g=h||document.createElement("body");if(parseInt(e,10))for(;e--;)n=document.createElement("div"),n.id=s?s[e]:c+(e+1),a.appendChild(n);return o=["&#173;",'<style id="s',c,'">',t,"</style>"].join(""),a.id=c,(h?a:g).innerHTML+=o,g.appendChild(a),h||(g.style.background="",g.style.overflow="hidden",l=d.style.overflow,d.style.overflow="hidden",d.appendChild(g)),r=i(a,t),h?a.parentNode.removeChild(a):(g.parentNode.removeChild(g),d.style.overflow=l),!!r};return H.csstransforms=function(){return!!r("transform")},H.csstransforms3d=function(){var t=!!r("perspective");return t&&"webkitPerspective"in d.style&&y("@media (transform-3d),(-webkit-transform-3d){#imageScrollModernizr{left:9px;position:absolute;height:3px;}}",function(i){t=9===i.offsetLeft&&3===i.offsetHeight}),t},h.prefixed=function(t,i,e){return i?r(t,i,e):r(t,"pfx")},window.requestAnimationFrame=h.prefixed("requestAnimationFrame",window)||function(t){var i=(new Date).getTime(),e=Math.max(0,16-(i-x)),s=window.setTimeout(function(){t(i+e)},e);return x=i+e,s},H.csstransforms3d()?b="csstransforms3d":H.csstransforms()&&(b="csstransforms"),""!==b&&(l=h.prefixed("transform")),n=function(i,e){return{init:function(){if(this.$imageHolder=t(i),this.settings=t.extend({},a,e),this.image=this.$imageHolder.data(this.settings.imageAttribute)||this.settings.image,this.mediaWidth=this.$imageHolder.data("width")||this.settings.mediaWidth,this.mediaHeight=this.$imageHolder.data("height")||this.settings.mediaHeight,this.coverRatio=this.$imageHolder.data("cover-ratio")||this.settings.coverRatio,this.extraHeight=this.$imageHolder.data("extra-height")||this.settings.extraHeight,this.ticking=!1,!this.image)throw new Error("You need to provide either a data-img attr or an image option");this.$scrollingElement=t("<img/>",{src:this.image}),this.settings.touch===!0?this.$scrollingElement.css({maxWidth:"100%"}).prependTo(this.$imageHolder):this.settings.parallax===!0?(this.$scrollerHolder=t("<div/>",{html:this.$imageHolder.html()}).css(this._getCSSObject({transform:l,top:0,left:0,x:0,y:0,visibility:"hidden",position:"fixed",overflow:"hidden"})).addClass(this.settings.holderClass).prependTo(this.settings.container),this.$imageHolder.css("visibility","hidden").empty(),this.$scrollingElement.css({position:"absolute",visibility:"hidden",maxWidth:"none"}).prependTo(this.$scrollerHolder)):(this.$scrollerHolder=this.$imageHolder.css({overflow:"hidden"}),this.$scrollingElement.css({position:"relative",overflow:"hidden"}).prependTo(this.$imageHolder)),this.settings.touch===!1&&(this._adjustImgHolderHeights(),this.settings.parallax===!0?this._updatePositions():this._updateFallbackPositions(),this._bindEvents())},_adjustImgHolderHeights:function(){var t,i,e,s,o,r,n,l,a,h,d,c,g=v.height(),m=v.width(),f=this.coverRatio*g;f=(this.settings.holderMinHeight<f?Math.floor(f):this.settings.holderMinHeight)+this.extraHeight,a=Math.floor(g-(g-f)*this.settings.speed),n=Math.round(this.mediaWidth*(a/this.mediaHeight)),n>=m?l=a:(n=m,l=Math.round(this.mediaHeight*(n/this.mediaWidth))),h=(a-f)/2,d=(l-a)/2,c=(g-f)/2,e=-(g/c*h)-d,s=f/c*h-d,o=s-e,r=g+f,t=-(h+d),i=Math.round((n-m)*-.5),this.$scrollingElement.css({height:l,width:n}),this.$imageHolder.height(f),this.$scrollerHolder.css({height:f,width:n}),this.scrollingState={winHeight:g,fromY:e,imgTopPos:t,imgLeftPos:i,imgHolderHeight:f,imgScrollingDistance:o,travelDistance:r,holderDistanceFromTop:this.$imageHolder.offset().top-v.scrollTop()}},_bindEvents:function(){var t=this;v.on("resize",function(){t._adjustImgHolderHeights(),t.settings.parallax===!0?t._requestTick():t._updateFallbackPositions()}),this.settings.parallax===!0&&v.on("scroll",function(){t.scrollingState.holderDistanceFromTop=t.$imageHolder.offset().top-v.scrollTop(),t._requestTick()})},_requestTick:function(){var t=this;this.ticking||(this.ticking=!0,requestAnimationFrame(function(){t._updatePositions()}))},_updatePositions:function(){if(this.scrollingState.holderDistanceFromTop<=this.scrollingState.winHeight&&this.scrollingState.holderDistanceFromTop>=-this.scrollingState.imgHolderHeight){var t=this.scrollingState.holderDistanceFromTop+this.scrollingState.imgHolderHeight,i=t/this.scrollingState.travelDistance,e=Math.round(this.scrollingState.fromY+this.scrollingState.imgScrollingDistance*(1-i));this.$scrollerHolder.css(this._getCSSObject({transform:l,x:Math.ceil(this.scrollingState.imgLeftPos),y:Math.round(this.scrollingState.holderDistanceFromTop),visibility:"visible"})),this.$scrollingElement.css(this._getCSSObject({transform:l,x:0,y:e,visibility:"visible"}))}else this.$scrollerHolder.css({visibility:"hidden"}),this.$scrollingElement.css({visibility:"hidden"});this.ticking=!1},_updateFallbackPositions:function(){this.$scrollerHolder.css({width:"100%"}),this.$scrollingElement.css({top:this.scrollingState.imgTopPos,left:this.scrollingState.imgLeftPos})},_getCSSObject:function(t){return"csstransforms3d"===b?t.transform="translate3d("+t.x+"px, "+t.y+"px, 0)":"csstransforms"===b?t.transform="translate("+t.x+"px, "+t.y+"px)":(t.top=t.y,t.left=t.x),t}}},n.defaults=a,t.fn.imageScroll=function(t){return this.each(function(){new n(this,t).init()})},n});